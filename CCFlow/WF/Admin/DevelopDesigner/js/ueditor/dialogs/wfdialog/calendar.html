<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title></title>
        <script type="text/javascript" src="../internal.js"></script>
        <script type="text/javascript" src="../../../jquery.js"></script>
        <script type="text/javascript" src="../../../bootstrap/bootstrap.js"></script>
        <link rel="stylesheet" href="../../../bootstrap/bootstrap.css">
        <link rel="stylesheet" href="../../../bootstrap/bootstrap-responsive.css">
        <style type="text/css">
            *{color: #838383;margin: 0;padding: 0}
            html,body {font-size: 12px;}
            body {
                padding-left: 20px;padding-right: 20px;
            }
        </style>
    </head>
    <body>
        <div id="tblwrap">
            <table class="table table-striped table-bordered" style="margin-top:18px;margin-bottom: 0;">
                <tr>
                    <th><span>コントロール名称</span><span class="label label-important">*</span></th>
                    <th><span>書式の種類</span> <span style="float:right;"><a title="カレンダーコントロールのヘルプを表示する" onclick="fnShowGuide();" class="btn"><i class="icon-question-sign"></i></a></span></th>
                </tr>
                <tr>
                    <td> <input id="txtName" placeholder="必須項目" type="text" size="20" /> </td>
                    <td>
                        <select id="dateFormat" onchange="fnShowDef(this.value);">
                            <option value="yyyy-MM-dd">日付、形は2010-09-09のようです。</option>
                            <option value="yyyy-MM-dd HH:mm:ss">日付、形は2010-09-09 09:25:00のようです。</option>
                            <option value="">カスタムフォーマット</option>
                        </select>
                        <br/><br/>
                        <blockquote>
                            <input type="text" id="def_format" style="display:none;" value="">
                        </blockquote>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="input-prepend input-append">
                            <span class="add-on">幅</span><input  style="display:inline;" id="txtWidth" size="3" type="text"><span class="add-on">px</span> &nbsp;&nbsp;
                            <span class="add-on">高さ</span><input  style="display:inline;" id="txtHeight" size="3" type="text"><span class="add-on">px</span>&nbsp;&nbsp;
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div style="display:none;margin-bottom: 27px;">
            <div class="page-header">
                <h3>カレンダーコントロールのヘルプ<span style="position: fixed;right: 20px;"><a title="コントロールのプロパティーページに戻る" onclick="fnShowGuide();" class="btn"><i class="icon-home"></i></a></span></h3>
            </div>
            <div>
                <blockquote>
                    <p>カレンダーコントロールは下図のような効果を実現します。</p>
                </blockquote>
                <img src="helper/calendar/calendar.jpg" />
                <p>また、選択用の入力フォーマットに加えて、カレンダーコントロールはカスタムフォーマットもサポートしています。カスタムフォーマットの要件は次のとおりです。</p><br/>
                <code>yMdHmswW</code><br/><br/>
				それぞれ、年、月、日、時、分、秒、週、曜日を表します。これらの要素を任意に組み合わせて、日付形式をカスタマイズできます。<br/><br/>
				日付フォーマット表：<br/><br/>
                <table class="table table-bordered table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>書式</th>
                            <th>説明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>y</code></td>
                            <td>
								年を最大2桁の数字とし、年が2桁以上の場合は、末尾の2桁のみが表示されます。
                            </td>
                        </tr>
                        <tr>
                            <td><code>yy</code></td>
                            <td>
								上記と同じように、2桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>yyy</code></td>
                            <td>
								年を3桁の数字として表示します。3桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>yyyy</code></td>
                            <td>
								年を4桁の数字として表示します。4桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>M</code></td>
                            <td>
								月を1から12までの数字とします。
                            </td>
                        </tr>
                        <tr>
                            <td><code>MM</code></td>
                            <td>
								上記と同じように、2桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>MMM</code></td>
                            <td>
								月の略語を返す　一月から十二月（英語：Jan to Dec）。
                            </td>
                        </tr>
                        <tr>
                            <td><code>MMMM</code></td>
                            <td>
								月のフルネームを返す 一月から十二月（英語：January to December）。
                            </td>
                        </tr>
                        <tr>
                            <td><code>d</code></td>
                            <td>
								月の日付を1から31までの数字として表します。
                            </td>
                        </tr>
                        <tr>
                            <td><code>dd</code></td>
                            <td>
								上記と同じように、2桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>H</code></td>
                            <td>
								時間を0から23までの数字と表します。
                            </td>
                        </tr>
                        <tr>
                            <td><code>HH</code></td>
                            <td>
								上記と同じように、2桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>m</code></td>
                            <td>
								分を0から59までの数字と表します。
                            </td>
                        </tr>
                        <tr>
                            <td><code>mm</code></td>
                            <td>
								上記と同じように、2桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>s</code></td>
                            <td>
								秒を0から59までの数字として表します。
                            </td>
                        </tr>
                        <tr>
                            <td><code>ss</code></td>
                            <td>
								上記と同じように、2桁未満の場合は、先頭にゼロを補います。
                            </td>
                        </tr>
                        <tr>
                            <td><code>w</code></td>
                            <td>
								曜日に対応する数字0(日曜日)-6(土曜日)を返します。
                            </td>
                        </tr>
                        <tr>
                            <td><code>D</code></td>
                            <td>
								曜日の略称を返す 日から土（英語：Sun to Sat）。
                            </td>
                        </tr>
                        <tr>
                            <td><code>DD</code></td>
                            <td>
								曜日のフルネームを返す 日曜日から土曜日（英語：Sunday to Saturday）。
                            </td>
                        </tr>
                        <tr>
                            <td><code>W</code></td>
                            <td>
								週に対応する数字(1-53)を返します。
                            </td>
                        </tr>
                        <tr>
                            <td><code>WW</code></td>
                            <td>
								上記と同じように、2桁未満の場合は、先頭にゼロを補います。（01 ～ 53）
                            </td>
                        </tr>
                    </tbody>
                </table>
				例：<br/><br/>
                <table class="table table-bordered table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>書式文字列</th>
                            <th>値</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>yyyy-MM-dd HH:mm:ss</code></td>
                            <td>2012-06-12 19:20:00</td>
                        </tr>
                        <tr>
                            <td><code>yy年M月</code></td>
                            <td> 12年8月</td>
                        </tr>
                        <tr>
                            <td><code>yyyyMMdd</code></td>
                            <td> 20080312 </td>
                        </tr>
                        <tr>
                            <td><code>現在時刻：yyyy 年M年d HH時mm分</code></td>
                            <td> 現在時刻：2012 年8月12日  19時20分 </td>
                        </tr>
                        <tr>
                            <td><code>H:m:s</code></td>
                            <td> 19:20:0 </td>
                        </tr>
                        <tr>
                            <td><code>y年</code></td>
                            <td> 8年</td>
                        </tr>
                        <tr>
                            <td><code>MMMM d, yyyy</code></td>
                            <td> 三月  12, 2012  </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <script type="text/javascript">
            var oNode = null;
            window.onload = function() {
                //弹出窗口初始化函数，这里主要是判断是编辑下拉列表还是新增
                if( UE.plugins['calendar'].editdom ){
                    oNode = UE.plugins['calendar'].editdom;
                    $G('txtName').value = oNode.getAttribute('title');
                    var sDateFmt = oNode.getAttribute('date_format');
                    if ( sDateFmt == null ) {
                        $G('dateFormat').value = "yyyy-MM-dd";
                    } else if ( sDateFmt == "yyyy-MM-dd" ) {
                        $G('dateFormat').options[0].selected = true;
                    } else if ( sDateFmt == "yyyy-MM-dd HH:mm:ss" ) {
                        $G('dateFormat').options[1].selected = true;
                    } else {
                        $G('dateFormat').value = "";
                        $G('def_format').value = sDateFmt;
                        $G('def_format').style.display = "";
                    }
                    var sWidth = oNode.style.width;
                    $G('txtWidth').value = sWidth.substr(0, sWidth.length - 2);//这里的substr是为了去掉末尾的'px'
                    var sHeight = oNode.style.height;
                    $G('txtHeight').value = sHeight.substr(0, sHeight.length - 2);
                }
                $('#showTips').popover({placement:'top'});
            }
            function fnShowDef(val){
                $G("def_format").style.display = val =="" ? "" : "none";
            }
            function fnShowGuide(){
                $('#tblwrap').slideToggle().siblings().slideToggle();
            }
            dialog.oncancel = function () {
                if( UE.plugins['calendar'].editdom ) {
                    delete UE.plugins['calendar'].editdom;
                }
            };
            dialog.onok = function (){
                if($G('txtName').value == '') {
                    alert('コントロール名は空にできません。');
                    $G('txtName').focus();
                    return false;
                }
                if( !oNode ) {
                    var sUrl =  parent.getItemUrl;
                    var nItemId = null;
                    ajax.request(sUrl, {timeout:60000,onsuccess:function (xhr) {
                            try {
                                nItemId = xhr.responseText;
                                oNode = document.createElement('input');
                                oNode.setAttribute('name','data_' + nItemId);
                                oNode.setAttribute('title',$G('txtName').value.replace("\"","&quot;"));
                                if( $G('dateFormat').value == '' ) {
                                    oNode.setAttribute('date_format',$G('def_format').value);
                                } else {
                                    oNode.setAttribute('date_format',$G('dateFormat').value);
                                }
                                if( $G('txtWidth').value!=''){
                                    oNode.style.width = $G('txtWidth').value + 'px';
                                } else {
                                    oNode.style.width = '100px';
                                }
                                if( $G('txtHeight').value!=''){
                                    oNode.style.height = $G('txtHeight').value + 'px';
                                } else {
                                    oNode.style.height = '25px';
                                }
                                oNode.setAttribute('class', 'date') ;
                                oNode.setAttribute('className', 'date');
                                editor.execCommand('insertHtml',oNode.outerHTML);
                            } catch (e) {
                                alert ( 'コントロールの挿入エラーが発生しました。OA管理者に連絡して解決してください。');
                                return false;
                            }
                        },
                        error:function () {
                            alert('Request TimeOut');
                            return false;
                        }
                    })
                } else {
                    if( $G('txtWidth').value!=''){
                        oNode.style.width = $G('txtWidth').value + 'px';
                    } else {
                        oNode.style.width = '100px';
                    }
                    if( $G('txtHeight').value!=''){
                        oNode.style.height = $G('txtHeight').value + 'px';
                    } else {
                        oNode.style.height = '25px';
                    }
                    oNode.setAttribute('title',$G('txtName').value.replace("\"","&quot;"));
                    if( $G('dateFormat').value == '' ) {
                        oNode.setAttribute('date_format',$G('def_format').value);
                    } else {
                        oNode.setAttribute('date_format',$G('dateFormat').value);
                    }
                    delete UE.plugins['calendar'].editdom; //使用后清空这个对象，变回新增模式
                }
            };
        </script>
    </body>
</html>